<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jameel Tolga | The Observer</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/phosphor-icons/1.4.2/src/css/icons.css" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        :root {
            /* THEME: Quantum Dark */
            --bg: #050507;
            --surface: #0f0f13;
            --surface-hover: #181820;
            --border: rgba(255, 255, 255, 0.08);
            --border-light: rgba(255, 255, 255, 0.15);
            
            /* ACCENTS */
            --primary: #FFFFFF;
            --secondary: #8B8B93;
            --accent: #64D2FF; /* Science Blue */
            --accent-glow: rgba(100, 210, 255, 0.15);
            
            /* SCORING COLORS */
            --s-high: #30D158;
            --s-mid: #FFD60A;
            --s-low: #FF453A;

            /* TYPOGRAPHY */
            --font-ui: 'Manrope', sans-serif;
            --font-mono: 'Space Mono', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
        
        body {
            background-color: var(--bg);
            color: var(--primary);
            font-family: var(--font-ui);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- BACKGROUND PARTICLES --- */
        #canvas-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
            opacity: 0.4;
        }

        /* --- NAVIGATION (SIDEBAR) --- */
        #app-shell {
            display: grid;
            grid-template-columns: 260px 1fr;
            height: 100%;
            position: relative;
            z-index: 10;
        }

        aside {
            background: rgba(10, 10, 14, 0.8);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .profile {
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        .profile h1 { font-size: 1.1rem; font-weight: 800; letter-spacing: -0.02em; }
        .profile p { font-size: 0.75rem; color: var(--secondary); font-family: var(--font-mono); margin-top: 5px; }

        .nav-menu { display: flex; flex-direction: column; gap: 5px; }
        .nav-btn {
            background: transparent;
            border: none;
            color: var(--secondary);
            padding: 12px 15px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            font-family: var(--font-ui);
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.2s;
        }
        .nav-btn:hover { background: var(--surface); color: var(--primary); }
        .nav-btn.active { background: var(--surface-hover); color: var(--accent); }
        .nav-btn i { font-size: 1.1rem; }

        .stats-mini {
            margin-top: auto;
            background: var(--surface);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.8rem; }
        .stat-row:last-child { margin-bottom: 0; }
        .stat-label { color: var(--secondary); }
        .stat-val { font-family: var(--font-mono); font-weight: 700; color: var(--primary); }

        /* --- MAIN VIEWPORT --- */
        main {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: rgba(5, 5, 7, 0.5);
        }

        /* TOOLBAR */
        .toolbar {
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            background: rgba(5, 5, 7, 0.9);
        }

        .search-container {
            position: relative;
            width: 350px;
        }
        .search-container i {
            position: absolute;
            left: 12px; top: 50%;
            transform: translateY(-50%);
            color: var(--secondary);
        }
        input[type="text"] {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 10px 10px 10px 35px;
            border-radius: 6px;
            color: var(--primary);
            font-family: var(--font-ui);
            font-size: 0.9rem;
            outline: none;
            transition: 0.2s;
        }
        input:focus { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-glow); }

        .view-toggles {
            display: flex;
            background: var(--surface);
            padding: 4px;
            border-radius: 6px;
            border: 1px solid var(--border);
        }
        .view-btn {
            background: transparent;
            border: none;
            padding: 6px 10px;
            color: var(--secondary);
            cursor: pointer;
            border-radius: 4px;
        }
        .view-btn.active { background: var(--surface-hover); color: var(--primary); }

        /* CONTENT AREA */
        .content-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* --- VIEW: GRID --- */
        .grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: 0.2s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            height: 220px;
        }
        .card:hover { transform: translateY(-3px); border-color: var(--border-light); }

        .card-top {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .c-title { font-weight: 700; font-size: 1rem; line-height: 1.3; }
        .c-year { font-family: var(--font-mono); font-size: 0.75rem; color: var(--secondary); margin-top: 4px; }
        
        .c-score {
            font-family: var(--font-mono);
            font-weight: 700;
            font-size: 1.2rem;
            padding: 4px 8px;
            border-radius: 6px;
            background: rgba(255,255,255,0.05);
        }

        .c-body {
            padding: 0 20px 20px;
            flex: 1;
        }
        .c-summary {
            font-size: 0.85rem;
            color: var(--secondary);
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.5;
        }

        /* --- VIEW: TABLE --- */
        .table-view { display: none; width: 100%; border-collapse: collapse; }
        .table-view th { text-align: left; padding: 10px 20px; border-bottom: 1px solid var(--border); color: var(--secondary); font-size: 0.8rem; text-transform: uppercase; cursor: pointer; }
        .table-view td { padding: 15px 20px; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .table-view tr:hover { background: var(--surface); cursor: pointer; }
        .t-score { font-family: var(--font-mono); font-weight: 700; }

        /* --- VIEW: GRAPH --- */
        .graph-view { display: none; width: 100%; height: 100%; position: relative; }
        #chart-canvas { width: 100%; height: 100%; cursor: crosshair; }

        /* --- MODAL (DOSSIER) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0; pointer-events: none;
            transition: 0.3s;
        }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }

        .dossier {
            background: #0E0E12;
            width: 600px;
            max-width: 90vw;
            border: 1px solid var(--border-light);
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.95);
            transition: 0.3s cubic-bezier(0.19, 1, 0.22, 1);
            overflow: hidden;
        }
        .modal-overlay.open .dossier { transform: scale(1); }

        .dossier-header {
            padding: 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: start;
        }
        .d-title { font-size: 1.8rem; font-weight: 800; line-height: 1.1; margin-bottom: 5px; }
        .d-meta { color: var(--secondary); font-family: var(--font-mono); font-size: 0.9rem; }
        
        .d-score-badge {
            text-align: center;
        }
        .d-score-val { font-size: 2.5rem; font-weight: 800; line-height: 1; display: block; }
        .d-z { font-size: 0.75rem; color: var(--secondary); font-family: var(--font-mono); }

        .dossier-body { padding: 30px; }
        .d-summary { font-size: 1rem; line-height: 1.6; color: #ddd; margin-bottom: 30px; }
        
        .d-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .d-stat-box { background: var(--surface); padding: 15px; border-radius: 8px; border: 1px solid var(--border); }
        .d-stat-label { font-size: 0.7rem; color: var(--secondary); text-transform: uppercase; display: block; margin-bottom: 5px; }
        .d-stat-num { font-family: var(--font-mono); font-size: 1.1rem; color: var(--accent); }

        .d-actions {
            padding: 20px 30px;
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
        }
        .btn-link {
            text-decoration: none;
            color: var(--primary);
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: 0.2s;
        }
        .btn-link:hover { background: var(--accent); color: #000; }
        .btn-close {
            position: absolute; top: 20px; right: 20px;
            background: transparent; border: none; color: var(--secondary);
            font-size: 1.5rem; cursor: pointer;
        }

        /* --- LOADER --- */
        #loader {
            position: fixed; inset: 0; background: var(--bg); z-index: 999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* RESPONSIVE */
        @media (max-width: 900px) {
            #app-shell { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
            aside { display: none; } /* Hide sidebar on mobile for simplicity */
            main { height: 100vh; }
            .dossier { width: 100%; height: 100%; border-radius: 0; max-width: none; overflow-y: auto; }
        }

    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <div style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--secondary);">INITIALIZING OBSERVER...</div>
    </div>

    <canvas id="canvas-bg"></canvas>

    <div id="app-shell">
        
        <aside>
            <div class="profile">
                <h1>JAMEEL TOLGA</h1>
                <p>PHYSICIST // CRITIC</p>
            </div>

            <div class="nav-menu">
                <button class="nav-btn active" onclick="setView('grid')"><i class="ph ph-squares-four"></i> Grid View</button>
                <button class="nav-btn" onclick="setView('table')"><i class="ph ph-table"></i> Data Ledger</button>
                <button class="nav-btn" onclick="setView('graph')"><i class="ph ph-chart-scatter"></i> Phase Space</button>
            </div>

            <div class="stats-mini">
                <div class="stat-row"><span class="stat-label">N (Count)</span><span class="stat-val" id="mini-n">0</span></div>
                <div class="stat-row"><span class="stat-label">&mu; (Mean)</span><span class="stat-val" id="mini-mean">0.0</span></div>
                <div class="stat-row"><span class="stat-label">&sigma; (Dev)</span><span class="stat-val" id="mini-sigma">0.0</span></div>
            </div>
        </aside>

        <main>
            <div class="toolbar">
                <div class="search-container">
                    <i class="ph ph-magnifying-glass"></i>
                    <input type="text" id="searchInput" placeholder="Query database...">
                </div>

                <div class="view-toggles">
                    <button class="view-btn" onclick="sortData('score')"><i class="ph ph-sort-ascending"></i> Score</button>
                    <button class="view-btn" onclick="sortData('year')"><i class="ph ph-calendar"></i> Year</button>
                </div>
            </div>

            <div class="content-scroll" id="content-area">
                
                <div id="grid-container" class="grid-view"></div>
                
                <table id="table-container" class="table-view">
                    <thead>
                        <tr>
                            <th onclick="sortData('title')">Title</th>
                            <th onclick="sortData('year')">Year</th>
                            <th onclick="sortData('score')">Score</th>
                            <th>Deviation</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>

                <div id="graph-container" class="graph-view">
                    <canvas id="chart-canvas"></canvas>
                </div>

            </div>
        </main>

    </div>

    <div class="modal-overlay" id="modal" onclick="closeModal(event)">
        <div class="dossier">
            <button class="btn-close" onclick="closeModalDirect()">&times;</button>
            <div class="dossier-header">
                <div>
                    <div class="d-title" id="m-title">Title</div>
                    <div class="d-meta" id="m-meta">Year</div>
                </div>
                <div class="d-score-badge">
                    <span class="d-score-val" id="m-score">00</span>
                    <span class="d-z" id="m-z">0.0σ</span>
                </div>
            </div>
            <div class="dossier-body">
                <div class="d-stats-grid">
                    <div class="d-stat-box">
                        <span class="d-stat-label">Percentile Rank</span>
                        <span class="d-stat-num" id="m-rank">Top 10%</span>
                    </div>
                    <div class="d-stat-box">
                        <span class="d-stat-label">Category</span>
                        <span class="d-stat-num" id="m-cat">Essential</span>
                    </div>
                </div>
                <div class="d-summary" id="m-summary">
                    Summary text...
                </div>
                <div class="d-actions">
                    <a href="#" target="_blank" class="btn-link" id="m-link">Access Source Data <i class="ph ph-arrow-up-right"></i></a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const FILE = 'ratings.txt';
        
        // STATE
        let DB = [];
        let FILTERED = [];
        let STATS = { mean:0, sigma:0, n:0 };
        let CURRENT_VIEW = 'grid';

        // --- INIT ---
        async function init() {
            initBackground();
            try {
                const res = await fetch(FILE);
                if(!res.ok) throw new Error("Missing ratings.txt");
                const text = await res.text();
                parse(text);
                document.getElementById('loader').style.display = 'none';
            } catch(e) {
                console.error(e);
                alert("Please ensure 'ratings.txt' is in the same folder.");
            }
        }

        // --- PARSER ---
        function parse(text) {
            const lines = text.split('\n');
            const regex = /^(\d+)\t(.*?)\s\((\d{4})\)$/;
            let current = null;

            lines.forEach(line => {
                line = line.trim();
                if(!line) return;
                const match = line.match(regex);
                if(match) {
                    if(current) DB.push(current);
                    current = {
                        score: parseInt(match[1]),
                        title: match[2],
                        year: parseInt(match[3]),
                        summary: '',
                        link: ''
                    };
                } else if(current) {
                    if(line.startsWith('http')) current.link = line;
                    else if(!line.startsWith('[source')) {
                        current.summary += (current.summary ? ' ' : '') + line.replace('Summary:', '').trim();
                    }
                }
            });
            if(current) DB.push(current);

            // Calc Stats
            STATS.n = DB.length;
            const sum = DB.reduce((a,b)=>a+b.score,0);
            STATS.mean = sum / STATS.n;
            const variance = DB.reduce((a,b)=>a+Math.pow(b.score-STATS.mean,2),0)/STATS.n;
            STATS.sigma = Math.sqrt(variance);

            // Hydrate Data with Physics
            DB.forEach(m => {
                m.z = (m.score - STATS.mean) / STATS.sigma;
                // Calculate percentile (simple)
                const worse = DB.filter(x => x.score < m.score).length;
                m.percentile = Math.round((worse / STATS.n) * 100);
            });

            // Update Sidebar Stats
            document.getElementById('mini-n').innerText = STATS.n;
            document.getElementById('mini-mean').innerText = STATS.mean.toFixed(1);
            document.getElementById('mini-sigma').innerText = STATS.sigma.toFixed(2);

            FILTERED = [...DB];
            render();
        }

        // --- RENDER DISPATCHER ---
        function render() {
            if(CURRENT_VIEW === 'grid') renderGrid();
            if(CURRENT_VIEW === 'table') renderTable();
            if(CURRENT_VIEW === 'graph') drawGraph();
        }

        // --- RENDERERS ---
        function renderGrid() {
            const container = document.getElementById('grid-container');
            container.innerHTML = '';
            
            FILTERED.forEach(m => {
                let color = 'var(--secondary)';
                if(m.score >= 80) color = 'var(--s-high)';
                else if(m.score >= 60) color = 'var(--s-mid)';
                else if(m.score < 50) color = 'var(--s-low)';

                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => openModal(m);
                card.innerHTML = `
                    <div class="card-top">
                        <div>
                            <div class="c-title">${m.title}</div>
                            <div class="c-year">${m.year}</div>
                        </div>
                        <div class="c-score" style="color:${color}">${m.score}</div>
                    </div>
                    <div class="c-body">
                        <div class="c-summary">${m.summary || "No summary available."}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderTable() {
            const body = document.getElementById('table-body');
            body.innerHTML = '';
            
            FILTERED.forEach(m => {
                const tr = document.createElement('tr');
                tr.onclick = () => openModal(m);
                let color = '#fff';
                if(m.score >= 80) color = 'var(--s-high)';
                
                tr.innerHTML = `
                    <td>${m.title}</td>
                    <td style="font-family:var(--font-mono)">${m.year}</td>
                    <td class="t-score" style="color:${color}">${m.score}</td>
                    <td style="font-family:var(--font-mono); color:var(--secondary)">${m.z > 0 ? '+' : ''}${m.z.toFixed(2)}σ</td>
                `;
                body.appendChild(tr);
            });
        }

        function drawGraph() {
            const canvas = document.getElementById('chart-canvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;

            // Clear
            ctx.clearRect(0,0,canvas.width, canvas.height);
            
            // Margins
            const pad = 40;
            const w = canvas.width - pad*2;
            const h = canvas.height - pad*2;

            // Ranges
            const years = FILTERED.map(m=>m.year);
            const minY = Math.min(...years);
            const maxY = Math.max(...years);
            const rangeY = maxY - minY + 2;

            // Draw Axis
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.beginPath();
            ctx.moveTo(pad, pad); ctx.lineTo(pad, h+pad); // Y axis (Score)
            ctx.lineTo(w+pad, h+pad); // X axis (Year)
            ctx.stroke();

            // Plot Points
            FILTERED.forEach(m => {
                const x = pad + ((m.year - (minY-1)) / rangeY) * w;
                const y = (pad+h) - ((m.score / 100) * h);

                let color = '#555';
                if(m.score >= 80) color = '#30D158';
                else if(m.score < 50) color = '#FF453A';

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI*2);
                ctx.fill();
            });
        }

        // --- INTERACTION ---
        function setView(view) {
            CURRENT_VIEW = view;
            
            // UI Toggle
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active')); // Reset top toggles if any
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); // Reset sidebar
            
            // Simple mapping for this demo
            document.getElementById('grid-container').style.display = view === 'grid' ? 'grid' : 'none';
            document.getElementById('table-container').style.display = view === 'table' ? 'table' : 'none';
            document.getElementById('graph-container').style.display = view === 'graph' ? 'block' : 'none';
            
            if(view === 'graph') setTimeout(drawGraph, 50); // Delay for layout
        }

        function sortData(key) {
            FILTERED.sort((a,b) => {
                if(key === 'score') return b.score - a.score;
                if(key === 'year') return b.year - a.year;
                if(key === 'title') return a.title.localeCompare(b.title);
            });
            render();
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            FILTERED = DB.filter(m => 
                m.title.toLowerCase().includes(term) || 
                (m.summary && m.summary.toLowerCase().includes(term))
            );
            render();
        });

        // --- MODAL SYSTEM ---
        function openModal(m) {
            const modal = document.getElementById('modal');
            
            document.getElementById('m-title').innerText = m.title;
            document.getElementById('m-meta').innerText = `${m.year} // ID: ${1000+DB.indexOf(m)}`;
            document.getElementById('m-score').innerText = m.score;
            document.getElementById('m-z').innerText = `${m.z > 0 ? '+' : ''}${m.z.toFixed(2)}σ`;
            document.getElementById('m-summary').innerText = m.summary || "No data.";
            document.getElementById('m-link').href = m.link;
            document.getElementById('m-rank').innerText = `Top ${100 - m.percentile}%`;
            
            // Category
            let cat = "Standard";
            if(m.score >= 85) cat = "Masterpiece";
            else if(m.score >= 80) cat = "Essential";
            else if(m.score < 50) cat = "Avoid";
            document.getElementById('m-cat').innerText = cat;

            // Color code score
            const scoreEl = document.getElementById('m-score');
            if(m.score >= 80) scoreEl.style.color = 'var(--s-high)';
            else if(m.score < 50) scoreEl.style.color = 'var(--s-low)';
            else scoreEl.style.color = 'var(--primary)';

            modal.classList.add('open');
        }

        function closeModal(e) {
            if(e.target.id === 'modal') {
                document.getElementById('modal').classList.remove('open');
            }
        }
        function closeModalDirect() {
            document.getElementById('modal').classList.remove('open');
        }

        // --- BACKGROUND FX ---
        function initBackground() {
            const cvs = document.getElementById('canvas-bg');
            const ctx = cvs.getContext('2d');
            
            let particles = [];
            
            function resize() {
                cvs.width = window.innerWidth;
                cvs.height = window.innerHeight;
            }
            window.addEventListener('resize', resize);
            resize();

            // Create Particles
            for(let i=0; i<50; i++) {
                particles.push({
                    x: Math.random() * cvs.width,
                    y: Math.random() * cvs.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() * 2
                });
            }

            function animate() {
                ctx.clearRect(0,0,cvs.width, cvs.height);
                ctx.fillStyle = 'rgba(255,255,255,0.15)';
                
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    if(p.x < 0) p.x = cvs.width;
                    if(p.x > cvs.width) p.x = 0;
                    if(p.y < 0) p.y = cvs.height;
                    if(p.y > cvs.height) p.y = 0;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                    ctx.fill();
                });
                requestAnimationFrame(animate);
            }
            animate();
        }

        // BOOT
        init();

    </script>
</body>
</html>
